/* ============================================================================
 *  DARK MODE SUPPORT
 *
 *  Supports BOTH automatic (system preference) AND manual toggle
 *
 *  HOW IT WORKS:
 *  1. Automatic: Uses @media (prefers-color-scheme: dark)
 *  2. Manual: Uses [data-theme="dark"] attribute on <html>
 *  3. Toggle button sets data-theme, overriding system preference
 *
 *  PRIORITY:
 *  - data-theme="light" → Force light mode
 *  - data-theme="dark" → Force dark mode
 *  - No data-theme → Follow system preference
 *  ============================================================================ */

/* ============================================================================
 *  DARK MODE VARIABLES - Shared between auto and manual modes
 *  ============================================================================ */

/* Apply dark mode when EITHER system prefers dark OR data-theme is dark */
@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
        /* Background Colors - Inverted */
        --color-background: #1a1d23;
        --color-surface: #242830;

        /* Text Colors - Light on dark */
        --color-text: #e4e6eb;
        --color-text-light: #b0b3b8;

        /* Border Colors */
        --color-border: #3a3f4b;

        /* Brand Colors - Adjusted for dark */
        --color-primary: #4a5f7f;
        --color-secondary: #5dade2;
        --color-accent: #ec7063;
        --color-success: #52be80;

        /* Code Display */
        --code-bg: #2c3038;

        /* Shadows - Softer */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.5);
        --shadow-xl: 0 8px 32px rgba(0, 0, 0, 0.6);
    }
}

/* Manual dark mode - applies when user toggles to dark */
:root[data-theme="dark"] {
    /* Background Colors */
    --color-background: #1a1d23;
    --color-surface: #242830;

    /* Text Colors */
    --color-text: #e4e6eb;
    --color-text-light: #b0b3b8;

    /* Border Colors */
    --color-border: #3a3f4b;

    /* Brand Colors */
    --color-primary: #4a5f7f;
    --color-secondary: #5dade2;
    --color-accent: #ec7063;
    --color-success: #52be80;

    /* Code Display */
    --code-bg: #2c3038;

    /* Shadows */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.5);
    --shadow-xl: 0 8px 32px rgba(0, 0, 0, 0.6);
}

/* ============================================================================
 *  COMPONENT OVERRIDES - Apply to both auto and manual dark mode
 *  ============================================================================ */

@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
        color-scheme: dark;
    }

    /* Links */
    :root:not([data-theme="light"]) a {
        color: var(--color-secondary);
    }

    :root:not([data-theme="light"]) a:hover,
    :root:not([data-theme="light"]) a:focus {
        color: #7fc8f8;
    }

    /* Code blocks */
    :root:not([data-theme="light"]) code,
    :root:not([data-theme="light"]) pre {
        background-color: var(--code-bg);
        color: #e4e6eb;
    }

    :root:not([data-theme="light"]) code {
        background-color: #3a3f4b;
        color: #7fc8f8;
    }

    /* Tables */
    :root:not([data-theme="light"]) .probability-table th {
        background: var(--color-background);
        color: var(--color-text);
    }

    :root:not([data-theme="light"]) .probability-table tbody tr:hover {
        background: rgba(93, 173, 226, 0.1);
    }

    /* Cards */
    :root:not([data-theme="light"]) .card,
    :root:not([data-theme="light"]) .card--project,
    :root:not([data-theme="light"]) .card--tool,
    :root:not([data-theme="light"]) .card--control,
    :root:not([data-theme="light"]) .card--key-section,
    :root:not([data-theme="light"]) .card--result {
        background-color: var(--color-surface);
        border-color: var(--color-border);
    }

    /* Key sections */
    :root:not([data-theme="light"]) .card--key-section.private-key {
        background: #3d2a2e;
        border-left-color: var(--color-accent);
    }

    :root:not([data-theme="light"]) .card--key-section.educational {
        background: #1e2f3d;
        border-left-color: var(--color-success);
    }

    /* Alerts */
    :root:not([data-theme="light"]) .alert--warning {
        background: #3d3526;
        border-left-color: #f39c12;
        color: #f8e08e;
    }

    :root:not([data-theme="light"]) .alert--error {
        background: #3d2a2e;
        border-left-color: #ec7063;
        color: #f5b7b1;
    }

    :root:not([data-theme="light"]) .alert--info {
        background: #1e2f3d;
        border-left-color: #5dade2;
        color: #aed6f1;
    }

    :root:not([data-theme="light"]) .alert--success {
        background: #27362f;
        border-left-color: #52be80;
        color: #a9dfbf;
    }

    :root:not([data-theme="light"]) .alert--security-note {
        background: #2c3e50;
        border-left-color: #5dade2;
        color: #aed6f1;
    }

    /* Forms */
    :root:not([data-theme="light"]) .form-group select,
    :root:not([data-theme="light"]) .form-group input[type="text"],
    :root:not([data-theme="light"]) .form-group input[type="number"],
    :root:not([data-theme="light"]) .form-group textarea {
        background-color: var(--color-surface);
        border-color: var(--color-border);
        color: var(--color-text);
    }

    :root:not([data-theme="light"]) .form-group select:focus,
    :root:not([data-theme="light"]) .form-group input:focus,
    :root:not([data-theme="light"]) .form-group textarea:focus {
        border-color: var(--color-secondary);
        background-color: #2c3038;
    }

    :root:not([data-theme="light"]) .form-option {
        background: var(--color-surface);
        border-color: var(--color-border);
    }

    /* Buttons */
    :root:not([data-theme="light"]) .btn-primary {
        background-color: var(--color-secondary);
        color: #1a1d23;
        font-weight: var(--font-weight-bold);
    }

    :root:not([data-theme="light"]) .btn-primary:hover:not(:disabled) {
        background-color: #7fc8f8;
    }

    :root:not([data-theme="light"]) .copy-btn {
        background-color: var(--color-secondary);
        color: #1a1d23;
    }

    :root:not([data-theme="light"]) .copy-btn:hover {
        background-color: #7fc8f8;
    }

    /* Hero & Welcome */
    :root:not([data-theme="light"]) .hero,
    :root:not([data-theme="light"]) .welcome-content {
        background: linear-gradient(135deg, #2c3e50, #34495e);
    }

    /* Math breakdown */
    :root:not([data-theme="light"]) .math-breakdown {
        background: #2a2438;
        color: var(--color-text);
    }

    :root:not([data-theme="light"]) .calculation {
        background: #2c3038;
        color: var(--color-text);
    }

    /* Code displays */
    :root:not([data-theme="light"]) .code-value,
    :root:not([data-theme="light"]) .binary-display,
    :root:not([data-theme="light"]) .message-display {
        background: var(--code-bg);
        color: var(--color-text);
    }

    :root:not([data-theme="light"]) .code-value code,
    :root:not([data-theme="light"]) code.code-block {
        background: #1a1d23;
        color: #7fc8f8;
    }

    /* Hash tool */
    :root:not([data-theme="light"]) .comparison-item {
        background: var(--color-surface);
        border-color: var(--color-border);
    }

    :root:not([data-theme="light"]) .hash-small {
        background: var(--code-bg);
        color: var(--color-text);
    }

    :root:not([data-theme="light"]) .stat-item {
        background: var(--color-surface);
    }

    :root:not([data-theme="light"]) .stat-value {
        color: var(--color-secondary);
    }

    :root:not([data-theme="light"]) .bit-diff-display {
        background: var(--code-bg);
        color: var(--color-text);
    }

    :root:not([data-theme="light"]) .bit-same {
        color: #52be80;
    }

    :root:not([data-theme="light"]) .bit-different {
        color: #ec7063;
    }

    /* Security badges */
    :root:not([data-theme="light"]) .security-badge.secure {
        background: #27362f;
        color: #a9dfbf;
    }

    :root:not([data-theme="light"]) .security-badge.deprecated {
        background: #3d3526;
        color: #f8e08e;
    }

    :root:not([data-theme="light"]) .security-badge.broken {
        background: #3d2a2e;
        color: #f5b7b1;
    }

    /* Tags */
    :root:not([data-theme="light"]) .tag {
        background-color: var(--color-surface);
        color: var(--color-secondary);
        border: 1px solid var(--color-border);
    }

    /* Placeholders */
    :root:not([data-theme="light"]) ::placeholder {
        color: var(--color-text-light);
        opacity: 0.6;
    }

    /* Selection */
    :root:not([data-theme="light"]) ::selection {
        background-color: var(--color-secondary);
        color: #1a1d23;
    }
}

/* Manual dark mode overrides - same styles */
:root[data-theme="dark"] {
    color-scheme: dark;
}

:root[data-theme="dark"] a {
    color: var(--color-secondary);
}

:root[data-theme="dark"] a:hover,
:root[data-theme="dark"] a:focus {
    color: #7fc8f8;
}

:root[data-theme="dark"] code,
:root[data-theme="dark"] pre {
    background-color: var(--code-bg);
    color: #e4e6eb;
}

:root[data-theme="dark"] code {
    background-color: #3a3f4b;
    color: #7fc8f8;
}

:root[data-theme="dark"] .probability-table th {
    background: var(--color-background);
    color: var(--color-text);
}

:root[data-theme="dark"] .probability-table tbody tr:hover {
    background: rgba(93, 173, 226, 0.1);
}

:root[data-theme="dark"] .card,
:root[data-theme="dark"] .card--project,
:root[data-theme="dark"] .card--tool,
:root[data-theme="dark"] .card--control,
:root[data-theme="dark"] .card--key-section,
:root[data-theme="dark"] .card--result {
    background-color: var(--color-surface);
    border-color: var(--color-border);
}

:root[data-theme="dark"] .card--key-section.private-key {
    background: #3d2a2e;
    border-left-color: var(--color-accent);
}

:root[data-theme="dark"] .card--key-section.educational {
    background: #1e2f3d;
    border-left-color: var(--color-success);
}

:root[data-theme="dark"] .alert--warning {
    background: #3d3526;
    border-left-color: #f39c12;
    color: #f8e08e;
}

:root[data-theme="dark"] .alert--error {
    background: #3d2a2e;
    border-left-color: #ec7063;
    color: #f5b7b1;
}

:root[data-theme="dark"] .alert--info {
    background: #1e2f3d;
    border-left-color: #5dade2;
    color: #aed6f1;
}

:root[data-theme="dark"] .alert--success {
    background: #27362f;
    border-left-color: #52be80;
    color: #a9dfbf;
}

:root[data-theme="dark"] .alert--security-note {
    background: #2c3e50;
    border-left-color: #5dade2;
    color: #aed6f1;
}

:root[data-theme="dark"] .form-group select,
:root[data-theme="dark"] .form-group input[type="text"],
:root[data-theme="dark"] .form-group input[type="number"],
:root[data-theme="dark"] .form-group textarea {
    background-color: var(--color-surface);
    border-color: var(--color-border);
    color: var(--color-text);
}

:root[data-theme="dark"] .form-group select:focus,
:root[data-theme="dark"] .form-group input:focus,
:root[data-theme="dark"] .form-group textarea:focus {
    border-color: var(--color-secondary);
    background-color: #2c3038;
}

:root[data-theme="dark"] .form-option {
    background: var(--color-surface);
    border-color: var(--color-border);
}

:root[data-theme="dark"] .btn-primary {
    background-color: var(--color-secondary);
    color: #1a1d23;
    font-weight: var(--font-weight-bold);
}

:root[data-theme="dark"] .btn-primary:hover:not(:disabled) {
    background-color: #7fc8f8;
}

:root[data-theme="dark"] .copy-btn {
    background-color: var(--color-secondary);
    color: #1a1d23;
}

:root[data-theme="dark"] .copy-btn:hover {
    background-color: #7fc8f8;
}

:root[data-theme="dark"] .hero,
:root[data-theme="dark"] .welcome-content {
    background: linear-gradient(135deg, #2c3e50, #34495e);
}

:root[data-theme="dark"] .math-breakdown {
    background: #2a2438;
    color: var(--color-text);
}

:root[data-theme="dark"] .calculation {
    background: #2c3038;
    color: var(--color-text);
}

:root[data-theme="dark"] .code-value,
:root[data-theme="dark"] .binary-display,
:root[data-theme="dark"] .message-display {
    background: var(--code-bg);
    color: var(--color-text);
}

:root[data-theme="dark"] .code-value code,
:root[data-theme="dark"] code.code-block {
    background: #1a1d23;
    color: #7fc8f8;
}

:root[data-theme="dark"] .comparison-item {
    background: var(--color-surface);
    border-color: var(--color-border);
}

:root[data-theme="dark"] .hash-small {
    background: var(--code-bg);
    color: var(--color-text);
}

:root[data-theme="dark"] .stat-item {
    background: var(--color-surface);
}

:root[data-theme="dark"] .stat-value {
    color: var(--color-secondary);
}

:root[data-theme="dark"] .bit-diff-display {
    background: var(--code-bg);
    color: var(--color-text);
}

:root[data-theme="dark"] .bit-same {
    color: #52be80;
}

:root[data-theme="dark"] .bit-different {
    color: #ec7063;
}

:root[data-theme="dark"] .security-badge.secure {
    background: #27362f;
    color: #a9dfbf;
}

:root[data-theme="dark"] .security-badge.deprecated {
    background: #3d3526;
    color: #f8e08e;
}

:root[data-theme="dark"] .security-badge.broken {
    background: #3d2a2e;
    color: #f5b7b1;
}

:root[data-theme="dark"] .tag {
    background-color: var(--color-surface);
    color: var(--color-secondary);
    border: 1px solid var(--color-border);
}

:root[data-theme="dark"] ::placeholder {
    color: var(--color-text-light);
    opacity: 0.6;
}

:root[data-theme="dark"] ::selection {
    background-color: var(--color-secondary);
    color: #1a1d23;
}
